<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Planner</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .hidden { display: none; }
    .admin-only { color: darkred; }
    input, select { margin: 5px 0; padding: 5px; width: 100%; }
    button { padding: 8px 16px; margin-top: 10px; cursor: pointer; }
  </style>
</head>
<body>
  <div id="loginSection">
    <h2>Login</h2>
    <input id="username" placeholder="Gebruikersnaam" />
    <input id="password" type="password" placeholder="Wachtwoord" />
    <button onclick="login()">Inloggen</button>
  </div>

  <div id="mainSection" class="hidden">
    <h2>Welkom, <span id="loggedInName"></span></h2>
    <button onclick="logout()">Uitloggen</button>

    <div id="eventMessage" class="hidden">
      <h3>üö´ Planner niet beschikbaar:</h3>
      <p id="eventText"></p>
    </div>

    <div id="plannerSection">
      <h3>üìÖ Ritplanner</h3>
      <input id="stelplaats" placeholder="Welke stelplaats?" />
      <input id="tijdVan" placeholder="Van uur (bv. 08:00)" />
      <input id="tijdTot" placeholder="Tot uur (bv. 16:30)" />
      <input id="lijn" placeholder="Lijnnummer" />
      <input id="bus" placeholder="Busnummer" />
      <input id="roblox" placeholder="Roblox username" />
      <button onclick="verzend()">Verzend</button>
    </div>

    <div id="adminPanel" class="hidden">
      <h3 class="admin-only">üõ†Ô∏è Adminpaneel</h3>

      <h4>Accounts beheren</h4>
      <input id="newUser" placeholder="Nieuwe gebruikersnaam" />
      <input id="newPass" placeholder="Wachtwoord" />
      <label><input type="checkbox" id="isAdminCheckbox" /> Admin?</label>
      <button onclick="voegAccountToe()">Voeg toe</button>

      <ul id="gebruikerLijst"></ul>
      <button onclick="toonGebruikers()">Toon gebruikers</button>

      <h4>Planner blokkeren (eventmodus)</h4>
      <input id="eventInput" placeholder="Eventbericht tonen..." />
      <button onclick="zetEvent()">Zet bericht</button>
      <button onclick="verwijderEvent()">Verwijder bericht</button>
    </div>
  </div>

  <script>
    let users = JSON.parse(localStorage.getItem("users")) || {
      "admin": { password: "admin123", isAdmin: true },
      "test": { password: "test123", isAdmin: false }
    };

    const webhookURL = "https://discord.com/api/webhooks/1373258119274037371/Yl07_As--QXXfYkpfnh77ITjYDv-ZcmT_Nd8eXaqmjlf0dVYE4CNOdG3wxOr6G256UAe";

    function saveUsers() {
      localStorage.setItem("users", JSON.stringify(users));
    }

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value;

      if (users[user] && users[user].password === pass) {
        localStorage.setItem("loggedInUser", user);
        toonHoofdscherm();
      } else {
        alert("Ongeldige inloggegevens");
      }
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      location.reload();
    }

    function toonHoofdscherm() {
      const user = localStorage.getItem("loggedInUser");
      if (!user || !users[user]) {
        logout();
        return;
      }

      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("mainSection").classList.remove("hidden");
      document.getElementById("loggedInName").textContent = user;

      if (users[user].isAdmin) {
        document.getElementById("adminPanel").classList.remove("hidden");
        // Admins zien altijd de planner en geen event blokkade
        document.getElementById("plannerSection").classList.remove("hidden");
        document.getElementById("eventMessage").classList.add("hidden");
      } else {
        document.getElementById("adminPanel").classList.add("hidden");
        const eventText = localStorage.getItem("eventText");
        if (eventText) {
          // Event actief: toon bericht en verberg planner
          document.getElementById("eventText").textContent = eventText;
          document.getElementById("eventMessage").classList.remove("hidden");
          document.getElementById("plannerSection").classList.add("hidden");
        } else {
          // Geen event: toon planner normaal
          document.getElementById("eventMessage").classList.add("hidden");
          document.getElementById("plannerSection").classList.remove("hidden");
        }
      }
    }

    function verzend() {
      const gebruiker = localStorage.getItem("loggedInUser");
      const stelplaats = document.getElementById("stelplaats").value.trim();
      const van = document.getElementById("tijdVan").value.trim();
      const tot = document.getElementById("tijdTot").value.trim();
      const lijn = document.getElementById("lijn").value.trim();
      const bus = document.getElementById("bus").value.trim();
      const roblox = document.getElementById("roblox").value.trim();

      if (!stelplaats || !van || !tot || !lijn || !bus || !roblox) {
        alert("Vul alle velden in voor de ritplanner!");
        return;
      }

      const content = `üöç **Rit Ingevuld**\nüë§ Gebruiker: ${gebruiker}\nüìç Stelplaats: ${stelplaats}\nüïê Uren: ${van} - ${tot}\nüöå Lijn: ${lijn}\nüî¢ Bus: ${bus}\nüéÆ Roblox: ${roblox}`;

      fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content })
      }).then(() => {
        alert("Verzonden naar Discord!");
        // Clear planner fields
        document.getElementById("stelplaats").value = "";
        document.getElementById("tijdVan").value = "";
        document.getElementById("tijdTot").value = "";
        document.getElementById("lijn").value = "";
        document.getElementById("bus").value = "";
        document.getElementById("roblox").value = "";
      }).catch(() => {
        alert("Fout bij verzenden naar Discord");
      });
    }

    function toonGebruikers() {
      const lijst = document.getElementById("gebruikerLijst");
      lijst.innerHTML = "";

      const huidigeGebruiker = localStorage.getItem("loggedInUser");
      if (!users[huidigeGebruiker]?.isAdmin) {
        alert("Geen toegang");
        return;
      }

      for (let naam in users) {
        const li = document.createElement("li");
        li.textContent = `${naam} | Wachtwoord: ${users[naam].password} | Admin: ${users[naam].isAdmin}`;
        lijst.appendChild(li);
      }
    }

    function voegAccountToe() {
      const naam = document.getElementById("newUser").value.trim();
      const wachtwoord = document.getElementById("newPass").value;
      const isAdmin = document.getElementById("isAdminCheckbox").checked;

      if (!naam || !wachtwoord) {
        alert("Vul alle velden in");
        return;
      }
      if (users[naam]) {
        alert("Gebruiker bestaat al");
        return;
      }

      users[naam] = { password: wachtwoord, isAdmin };
      saveUsers();
      alert("Gebruiker toegevoegd!");
      document.getElementById("newUser").value = "";
      document.getElementById("newPass").value = "";
      document.getElementById("isAdminCheckbox").checked = false;
      toonGebruikers();
    }

    function zetEvent() {
      const text = document.getElementById("eventInput").value.trim();
      if (!text) {
        alert("Voer een reden in voor de blokkade");
        return;
      }
      localStorage.setItem("eventText", text);
      alert("Planner geblokkeerd met bericht");
      location.reload();
    }

    function verwijderEvent() {
      localStorage.removeItem("eventText");
      alert("Eventbericht verwijderd");
      location.reload();
    }

    // Start van de app
    if (localStorage.getItem("loggedInUser")) {
      toonHoofdscherm();
    }
  </script>
</body>
</html>
