<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planner</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .hidden { display: none; }
    .admin-only { color: darkred; }
    input, select { margin: 5px 0; padding: 5px; width: 100%; }
    button { padding: 8px 16px; margin-top: 10px; }
    ul { list-style: none; padding: 0; }
    li { background: white; margin: 5px 0; padding: 8px; border-radius: 4px; }
  </style>
</head>
<body>
  <div id="loginSection">
    <h2>Login</h2>
    <input id="username" placeholder="Gebruikersnaam" />
    <input id="password" type="password" placeholder="Wachtwoord" />
    <button onclick="login()">Inloggen</button>
  </div>

  <div id="mainSection" class="hidden">
    <h2>Welkom, <span id="loggedInName"></span></h2>
    <button onclick="logout()">Uitloggen</button>

    <div id="eventMessage" class="hidden">
      <h3>ğŸš« Planner niet beschikbaar:</h3>
      <p id="eventText"></p>
    </div>

    <div id="plannerSection">
      <h3>ğŸ“… Ritplanner</h3>
      <input id="stelplaats" placeholder="Welke stelplaats?" />
      <input id="tijdVan" placeholder="Van uur (bv. 08:00)" />
      <input id="tijdTot" placeholder="Tot uur (bv. 16:30)" />
      <input id="lijn" placeholder="Lijnnummer" />
      <input id="bus" placeholder="Busnummer" />
      <input id="roblox" placeholder="Roblox username" />
      <button onclick="verzend()">Verzend</button>
    </div>

    <div id="adminPanel" class="hidden">
      <h3 class="admin-only">ğŸ› ï¸ Adminpaneel</h3>

      <h4>Accounts beheren</h4>
      <input id="newUser" placeholder="Nieuwe gebruikersnaam" />
      <input id="newPass" placeholder="Wachtwoord" />
      <label><input type="checkbox" id="isAdminCheckbox" /> Admin?</label>
      <button onclick="voegAccountToe()">Voeg toe</button>

      <ul id="gebruikerLijst"></ul>
      <button onclick="haalGebruikersOp()">Toon gebruikers</button>

      <h4>Planner blokkeren (eventmodus)</h4>
      <input id="eventInput" placeholder="Eventbericht tonen..." />
      <button onclick="zetEvent()">Zet bericht</button>
      <button onclick="verwijderEvent()">Verwijder bericht</button>
    </div>
  </div>

  <script>
    async function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;

      const response = await fetch('/api/login', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username: user, password: pass })
      });

      const result = await response.json();

      if (result.success) {
        localStorage.setItem("loggedInUser", user);
        localStorage.setItem("isAdmin", result.isAdmin);
        toonHoofdscherm();
      } else {
        alert("Ongeldige inloggegevens");
      }
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      localStorage.removeItem("isAdmin");
      location.reload();
    }

    function toonHoofdscherm() {
      document.getElementById("loginSection").classList.add("hidden");
      document.getElementById("mainSection").classList.remove("hidden");

      const user = localStorage.getItem("loggedInUser");
      document.getElementById("loggedInName").textContent = user;

      if (localStorage.getItem("isAdmin") === 'true') {
        document.getElementById("adminPanel").classList.remove("hidden");
      }

      haalEvent();
    }

    async function verzend() {
      const gebruiker = localStorage.getItem("loggedInUser");
      const stelplaats = document.getElementById("stelplaats").value;
      const van = document.getElementById("tijdVan").value;
      const tot = document.getElementById("tijdTot").value;
      const lijn = document.getElementById("lijn").value;
      const bus = document.getElementById("bus").value;
      const roblox = document.getElementById("roblox").value;

      const data = { gebruiker, stelplaats, van, tot, lijn, bus, roblox };

      const response = await fetch('/api/submit', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if (response.ok) {
        alert("Verzonden naar Discord!");
      } else {
        alert("Fout bij verzenden");
      }
    }

    async function haalGebruikersOp() {
      const response = await fetch('/api/users');
      const users = await response.json();

      const lijst = document.getElementById("gebruikerLijst");
      lijst.innerHTML = "";

      users.forEach(user => {
        const li = document.createElement("li");
        li.textContent = `${user.username} | Admin: ${user.isAdmin}`;
        lijst.appendChild(li);
      });
    }

    async function voegAccountToe() {
      const naam = document.getElementById("newUser").value;
      const wachtwoord = document.getElementById("newPass").value;
      const isAdmin = document.getElementById("isAdminCheckbox").checked;

      if (!naam || !wachtwoord) return alert("Vul alle velden in");

      const response = await fetch('/api/users', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username: naam, password: wachtwoord, isAdmin })
      });

      const result = await response.json();
      alert(result.message);
      if (result.success) {
        document.getElementById("newUser").value = '';
        document.getElementById("newPass").value = '';
        document.getElementById("isAdminCheckbox").checked = false;
        haalGebruikersOp();
      }
    }

    async function zetEvent() {
      const text = document.getElementById("eventInput").value;

      const response = await fetch('/api/event', {
        method: 'POST',
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
      });

      if (response.ok) {
        alert("Planner geblokkeerd met bericht");
        haalEvent();
      } else {
        alert("Fout bij event instellen");
      }
    }

    async function verwijderEvent() {
      const response = await fetch('/api/event', { method: 'DELETE' });
      if (response.ok) {
        alert("Eventbericht verwijderd");
        haalEvent();
      } else {
        alert("Fout bij event verwijderen");
      }
    }

    async function haalEvent() {
      const response = await fetch('/api/event');
      if (!response.ok) return;

      const data = await response.json();

      if (data.message) {
        document.getElementById("eventText").textContent = data.message;
        document.getElementById("eventMessage").classList.remove("hidden");
        document.getElementById("plannerSection").classList.add("hidden");
      } else {
        document.getElementById("eventMessage").classList.add("hidden");
        document.getElementById("plannerSection").classList.remove("hidden");
      }
    }

    window.onload = () => {
      if (localStorage.getItem("loggedInUser")) {
        toonHoofdscherm();
      }
    };
  </script>
</body>
</html>
